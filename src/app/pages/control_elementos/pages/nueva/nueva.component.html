<div id="initial" class="dark:bg-gray-900 h-screen p-4">
  <div class="flex sm:flex-row flex-col justify-between items-center p-1">
     <h2 class="text-2xl font-semibold mb-2 text-gray-800 dark:text-gray-100 tracking-tight">Prestamo de elementos</h2>
     <button (click)="regresar()" class="flex items-center gap-2 px-2 py-1 bg-slate-500 hover:bg-slate-600 active:bg-slate-700 text-white text-sm rounded-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-1">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
       </svg>
       Regresar
     </button>


  </div>
  

<div
    *ngIf="isLoading"
    class="absolute inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"
  >
    <div class="flex flex-col items-center">
      <svg
        class="animate-spin h-12 w-12 text-white"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8v8H4z"
        ></path>
      </svg>
      <p class="mt-4 text-white text-lg font-semibold">Procesando...</p>
    </div>
  </div>

  @if (solicitudActual().orderSelected===null) {
  <search-metrics
    [typeSearch]="type"
    (onSelectOrder)="onSelectOrder($event)"
    class="mb-4"
  />
  } @if(solicitudActual().orderSelected){
  <div class="grid grid-cols-5 space-x-2">
    <div
      class="w-full mx-auto mt-4 bg-white dark:bg-slate-800 rounded-xl shadow-lg col-span-2"
    >
      <div class="py-6 px-6">
        <div class="flex items-center justify-between">
          <h1 class="text-lg font-bold text-slate-900 dark:text-white">
            Componentes
          </h1>
          <button
            (click)="clearSelectedOrder()"
            type="button"
            class="ml-4 text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-slate-300"
          >
            <span class="sr-only">Cerrar</span>
            <svg
              class="h-6 w-6"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <hr class="my-4 border-slate-200 dark:border-slate-700" />
        <div class="grid grid-cols-1 gap-x-4 gap-y-4 text-sm">          
            <div class="flex justify-between">
              <dt class="font-medium text-slate-500 dark:text-slate-400">
                No. Orden {{ selectedOrder()!.NoOrden }}
              </dt>
              <dd class="mt-1 text-slate-900 dark:text-slate-300">
              {{ selectedOrder()!.NombreTrabajo }}
            </dd>            
          </div>
        </div>
        
      
      
        @if(componentes().length > 0){
          <div class="flex flex-col text-sm mt-6">
          <p-listbox
            [options]="componentes()"
            filterPlaceHolder="Buscar componente"
            optionLabel="descripcion"
            [filter]="true"
            scrollHeight="30rem"
            class="w-full"
            (onChange)="onChangeSelectComponent($event)"
          >
            <ng-template #item let-item>
        <div class="flex justify-between gap-2 w-full">
            <div>{{ item.descripcion }}</div>
            <div class="bg-purple-500 text-white text-xs font-bold px-2 py-1 rounded-full">{{ item.totalSeleccionados }}</div>
        </div>
    </ng-template>
          </p-listbox>
        </div>
        }@else {
          <div class="flex items-center justify-center h-16 mt-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg px-2">
    <div class="flex items-center gap-2">
      <svg class="w-6 h-6 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
      </svg>
      <p class="text-yellow-800 dark:text-yellow-200 font-medium text-sm">
        Esta orden no tiene definida la liberaci√≥n de sobre en preprensa
      </p>
    </div>
  </div>
        }
        


      </div>
    </div>
    @if(componenteSeleccionado()){
    <div
      class="w-full mx-auto mt-4 bg-white dark:bg-slate-800 rounded-xl shadow-lg col-span-3"
    >
      <div class="py-6 px-6">
        <div class="flex items-center justify-between">
          <h1 class="text-lg font-bold text-slate-900 dark:text-white">
            Elementos
          </h1>
          <button
            [disabled]="!tieneInformacionSeleccionado()"
            (click)="registrarPrestamo()"
            class="border border-slate-300 rounded-md px-2 py-1 text-sm bg-purple-500 text-white disabled:bg-slate-200 disabled:text-slate-400 dark:disabled:bg-slate-700 dark:disabled:text-slate-500"
          >
            Registrar prestamo
          </button>          
        </div>
        <hr class="my-4 border-slate-200 dark:border-slate-700" />
        <div class="flex flex-col gap-4 text-sm mt-6">          
          <div>
          
            <ul class="space-y-1">
              @for( item of componenteSeleccionado(); track
              item.componente) {
              <li class="border-b border-slate-200 dark:border-slate-700 pb-2">
                <div class="flex justify-between">
                  <h2 class="text-xl text-purple-500 ">{{ item.componente }}</h2>                
                   <button  (click)="toogleSeleccion()" class="border border-slate-300 w-36 rounded-md px-2 py-1  text-bold">
                  <span >
                    {{ !todos ? 'Desmarcar todos' : 'Marcar todos' }}
                  </span>
        </button>
                </div>                
                <div class="border rounded-sm mt-2 p-2">
                  <p-selectbutton
                  (onChange)="seleccionarElemento($event,item.componente)" 
                    [options]="item.elementos"
                    [ngModel]="item.idSeleccionados"
                    optionDisabled="isDisabled"
                    size="small"                    
                    [multiple]="true"
                    optionLabel="descripcion"
                    size="small"
                  >    
                  <ng-template #item let-item>
                    <div class="flex flex-col justify-center items-center w-full  uppercase text-[10px]">                      
                      <div >{{item.descripcion}}</div> 
                      @if(item.isDisabled){
                      <div class="text-[9px] text-gray-500 dark:text-gray-400 uppercase">{{`PRESTADO A ${item.usuarioPosee}`}}</div>  
                    }@else {
                        <div class="text-[9px] text-green-500 ">
                          DISPONIBLE
                        </div>  
                    }
                    </div>           
                  </ng-template>                
                  </p-selectbutton>
                </div>                
              </li>
              }
            </ul>
          </div>
        </div>
      </div>
    </div>
    }
  </div> 
  }  
</div>
